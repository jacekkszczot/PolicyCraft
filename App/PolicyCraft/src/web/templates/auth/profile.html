{% extends "base.html" %}

{% block title %}Profile - PolicyCraft{% endblock %}

{% block content %}
<div class="profile-container">
    <h1>User Profile</h1>
    
    <div class="profile-card">
        <div class="profile-header">
            <p class="welcome-text">Welcome to your profile</p>
            <h2>{{ user.get_full_name() }}</h2>
            
        </div>
        
        <div class="profile-details">
            <div class="detail-row">
                <strong>Username:</strong> {{ user.username }}
            </div>
            <div class="detail-row">
                <strong>Email:</strong> {{ user.email }}
            </div>
            {% if user.institution %}
            <div class="detail-row">
                <strong>Institution:</strong> {{ user.institution }}
            </div>
            {% endif %}
            <div class="detail-row">
                <strong>Member since:</strong> {{ user.created_at.strftime('%B %Y') }}
            </div>
            {% if user.last_login %}
            <div class="detail-row">
                <strong>Last login:</strong> {{ user.last_login.strftime('%d %B %Y at %H:%M') }}
            </div>
            {% endif %}
        </div>
        
        <div class="profile-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Go to Dashboard</a>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Logout</a>
        </div>

        <!-- Update Profile Section -->
        <div class="profile-card">
            <h3>Update Profile</h3>
            <form action="{{ url_for('auth.update_profile') }}" method="post" class="profile-form">
                <div class="form-row">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="male" {% if user.gender=='male' %}selected{% endif %}>Male</option>
                        <option value="female" {% if user.gender=='female' %}selected{% endif %}>Female</option>
                        <option value="other" {% if user.gender=='other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="first_name">First name</label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="last_name">Last name</label>
                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="institution">Institution</label>
                    <input type="text" id="institution" name="institution" value="{{ user.institution or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>

        <!-- Change Password Section -->
        <div class="profile-card">
            <h3>Change Password</h3>
            <form action="{{ url_for('auth.change_password') }}" method="post" class="profile-form">
                <div class="form-row">
                    <label for="current_password">Current password</label>
                    <input type="password" id="current_password" name="current_password" required>
                </div>
                <div class="form-row">
                    <label for="new_password">New password</label>
                    <input type="password" id="new_password" name="new_password" required>
                </div>
                <div class="form-row">
                    <label for="confirm_password">Confirm new password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>
                <button type="submit" class="btn btn-primary">Change Password</button>
            </form>
        </div>

        <!-- Delete Account Section -->
        <div class="profile-card danger-zone">
            <h3>Danger Zone</h3>
            <p>Delete your account and all associated data. This action is irreversible.</p>
            <form action="{{ url_for('auth.delete_account') }}" method="post" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.');">
                <button type="submit" class="btn btn-danger">Delete Account</button>
            </form>
        </div>

        <div class="profile-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
</div>
{% endblock %}
