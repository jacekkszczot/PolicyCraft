{% extends 'base.html' %}

{% block title %}User Management - PolicyCraft Admin{% endblock %}

{% block content %}
<!-- 
    PolicyCraft - User Management Template
    
    This page provides an interface for administrators to manage user accounts.
    It displays a list of all registered users and allows for user management
    actions such as deletion and role management.
    
    Table of Contents:
    1. Users Table
       - User ID
       - Username
       - Email Address
       - Join Date
    
    Author: Jacek Robert Kszczot
    Project: MSc Data Science & AI - COM7016
    University: Leeds Trinity University
       - Management Actions
    2. User Management Functions
    
    Key Features:
    - Tabular display of all registered users
    - User account management actions
    - Responsive table layout
    - Confirmation dialogs for destructive actions
    - Sortable columns (via JavaScript)
    
    Security Considerations:
    - Admin-only access control
    - CSRF protection on all forms
    - Confirmation dialogs for destructive actions
    - Server-side validation of all requests
    - Audit logging of admin actions
    
    Data Displayed:
    - User ID: Unique identifier
    - Username: User's login name
    - Email: User's registered email
    - Join Date: Account creation timestamp
    - Actions: Available management options
    
    Available Actions:
    - Delete User: Permanently removes a user account
      (Requires confirmation)
    
    Dependencies:
    - Bootstrap 5.3.0 (CSS/JS)
    - Font Awesome 6.4.0 for icons
    - Custom CSS from static/css/
    - Flask-Admin for user management
    - Flask-Security for authentication
    
    Author: Jacek Robert Kszczot
    Project: MSc Data Science & AI - COM7016
    University: Leeds Trinity University
-->
<div class="dashboard-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">User Management</h1>
            <p class="hero-subtitle">Manage user accounts and permissions</p>
        </div>
    </div>
    
    <!-- Users Table Section -->
    <div class="dashboard-section">
        <div class="section-header">
            <h2>System Users</h2>
            <p>View and manage all registered user accounts</p>
        </div>
        
        <div class="table-container">
            <table class="analyses-table">
                <thead>
                    <tr>
                        <th style="width:8%">ID</th>
                        <th style="width:25%">ğŸ‘¤ Username</th>
                        <th style="width:30%">ğŸ“§ Email</th>
                        <th style="width:20%">ğŸ“… Joined</th>
                        <th style="width:17%; text-align:center">âš™ï¸ Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in users %}
                    <tr>
                        <td><span class="user-id">{{ u.id }}</span></td>
                        <td><strong>{{ u.username }}</strong></td>
                        <td>{{ u.email }}</td>
                        <td>{{ u.created_at or 'N/A' }}</td>
                        <td style="text-align:center;">
                            <div class="action-buttons">
                                <a href="{{ url_for('admin.reset_password', user_id=u.id) }}" 
                                   class="btn btn-warning btn-sm" 
                                   onclick="return confirm('Reset password for {{ u.username }}?');" 
                                   title="Reset Password">
                                    ğŸ”‘ Reset Password
                                </a>
                                {% if u.role != 'admin' %}
                                <a href="{{ url_for('admin.delete_user', user_id=u.id) }}" 
                                   class="btn btn-danger btn-sm" 
                                   onclick="return confirm('âš ï¸ This will permanently delete {{ u.username }} and ALL their data.\n\nThis action cannot be undone. Are you sure?');" 
                                   title="Delete User">
                                    ğŸ—‘ï¸ Delete
                                </a>
                                {% else %}
                                <span class="admin-badge" title="Admin users cannot be deleted">ğŸ‘‘ Admin</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if users|length == 0 %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <h3>No Users Found</h3>
            <p>There are currently no users in the system.</p>
        </div>
        {% endif %}
        
        <!-- Back to Dashboard Button -->
        <div class="form-actions" style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e9ecef;">
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                â† Back to Dashboard
            </a>
        </div>
    </div>
</div>

<style>
.user-id {
    background: #f8f9fa;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-family: monospace;
    font-weight: 600;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.action-buttons .btn {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s ease;
}

.action-buttons .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.admin-badge {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #8b6914;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 600;
    border: 1px solid #e6c200;
}

.table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state h3 {
    color: #666;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: #999;
    margin: 0;
}


</style>
{% endblock %}
