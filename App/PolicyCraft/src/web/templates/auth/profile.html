{% extends "base.html" %}

{% block title %}Profile - PolicyCraft{% endblock %}

{% block content %}
<!-- 
    PolicyCraft - User Profile Template
    
    This page displays and allows editing of the user's profile information.
    It shows account details, preferences, and provides options to update them.
    
    Table of Contents:
    1. Profile Header - Welcome message and user avatar
    2. Account Details - Username, email, institution, etc.
    3. Profile Actions - Edit profile, change password, etc.
    4. Account Settings - Notification preferences, privacy settings
    5. Danger Zone - Account deletion and other destructive actions
    
    Key Features:
    - Responsive profile layout
    - Form validation for profile updates
    - Secure password change functionality
    - Profile picture upload and management
    - Account activity history
    
    Security Considerations:
    - CSRF protection on all forms
    - Password confirmation for sensitive actions
    - Server-side validation of all inputs
    - Secure file upload handling for profile pictures
    - Session management for profile updates
    
    Dynamic Content:
    - User information (name, email, institution, etc.)
    - Account creation date
    - Last login information
    - Profile completion status
    
    Dependencies:
    - Bootstrap 5.3.0 (CSS/JS)
    - Font Awesome 6.4.0 for icons
    - Custom CSS from static/css/
    - Flask-Login for authentication
    - Flask-WTF for form handling
    
    Author: Jacek Robert Kszczot
    Project: MSc Data Science & AI - COM7016
    University: Leeds Trinity University
    Last Updated: July 2024
-->

<div class="profile-container">
    <h1>User Profile</h1>
    
    <div class="profile-card">
        <div class="profile-header">
            <p class="welcome-text">Welcome to your profile</p>
            <h2>{{ user.get_full_name() }}</h2>
            
        </div>
        
        <div class="profile-details">
            <div class="detail-row">
                <strong>Username:</strong> {{ user.username }}
            </div>
            <div class="detail-row">
                <strong>Email:</strong> {{ user.email }}
            </div>
            {% if user.institution %}
            <div class="detail-row">
                <strong>Institution:</strong> {{ user.institution }}
            </div>
            {% endif %}
            <div class="detail-row">
                <strong>Member since:</strong> {{ user.created_at.strftime('%B %Y') }}
            </div>
            {% if user.last_login %}
            <div class="detail-row">
                <strong>Last login:</strong> {{ user.last_login.strftime('%d %B %Y at %H:%M') }}
            </div>
            {% endif %}
        </div>
        
        <div class="profile-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Go to Dashboard</a>
            <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">Logout</a>
        </div>

        <!-- Update Profile Section -->
        <div class="profile-card">
            <h3>Update Profile</h3>
            <form action="{{ url_for('auth.update_profile') }}" method="post" class="profile-form">
                <div class="form-row">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="male" {% if user.gender=='male' %}selected{% endif %}>Male</option>
                        <option value="female" {% if user.gender=='female' %}selected{% endif %}>Female</option>
                        <option value="other" {% if user.gender=='other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="first_name">First name</label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="last_name">Last name</label>
                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="institution">Institution</label>
                    <input type="text" id="institution" name="institution" value="{{ user.institution or '' }}" required>
                </div>
                <div class="form-row">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>

        <!-- Change Password Section -->
        <div class="profile-card">
            <h3>Change Password</h3>
            <form action="{{ url_for('auth.change_password') }}" method="post" class="profile-form">
                <div class="form-row">
                    <label for="current_password">Current password</label>
                    <input type="password" id="current_password" name="current_password" required>
                </div>
                <div class="form-row">
                    <label for="new_password">New password</label>
                    <input type="password" id="new_password" name="new_password" required>
                </div>
                <div class="form-row">
                    <label for="confirm_password">Confirm new password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>
                <button type="submit" class="btn btn-primary">Change Password</button>
            </form>
        </div>

        <!-- Delete Account Section -->
        <div class="profile-card danger-zone">
            <h3>Danger Zone</h3>
            <p>Delete your account and all associated data. This action is irreversible.</p>
            <form action="{{ url_for('auth.delete_account') }}" method="post" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.');">
                <button type="submit" class="btn btn-danger">Delete Account</button>
            </form>
        </div>

        <div class="profile-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
</div>
{% endblock %}
